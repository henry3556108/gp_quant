# 專案完整 Review Checklist

**目標**: 100% 掌握 GP Quant Trading 專案  
**更新日期**: 2025-10-07  
**進度**: 6/13 完成（選擇算子已合併至演化引擎）

---

## 📊 整體進度

- **已完成**: 6 個檔案/模組
- **進行中**: 0 個檔案
- **待完成**: 7 個檔案
- **完成率**: 46.2%

---

## 🎯 Review 優先級說明

- 🔴 **P0 - 核心必讀**: 理解專案運作的關鍵文件
- 🟡 **P1 - 重要**: 深入理解演化和回測邏輯
- 🟢 **P2 - 補充**: 輔助功能和工具
- 🔵 **P3 - 參考**: 文檔和配置

---

## ✅ 已完成

### 🔴 P0 - 主程序
- [x] **main.py** (436 行)
  - **完成日期**: 2025-10-01
  - **核心功能**: 
    - Portfolio Evolution 模式 ✅
    - Single Ticker 模式 ✅
    - Load & Backtest 模式 ✅
  - **關鍵理解**:
    - 時間配置（初始期 + 回測期）
    - 數據流（train_data → evolution → test_data）
    - 三個返回值（pop, log, hof）
  - **筆記**: 已理解 DEAP 框架的基本使用

---

## 🔴 P0 - 核心必讀 (4/5 完成)

### 1. 演化引擎
- [v] **gp_quant/evolution/engine.py** (~180 行)
  - **優先級**: 🔴 最高
  - **為什麼重要**: 整個 GP 演化的核心邏輯
  - **需要理解**:
    - [v] `run_evolution()` 函數完整流程
    - [v] DEAP Toolbox 配置（已部分理解）
    - [v] 演化循環（選擇、交配、變異）
    - [v] Fitness 評估機制
    - [v] 統計記錄和日誌
  - **關鍵問題**:
    - 如何處理無效個體？
    - 如何更新 Hall of Fame？
    - 演化終止條件是什麼？
  - **預估時間**: 45 分鐘

### 2. GP 原語定義
- [v] **gp_quant/gp/operators.py** (84 行)
  - **優先級**: 🔴 高
  - **為什麼重要**: 定義交易規則的語法和類型系統
  - **需要理解**:
    - [v] 類型系統（NumVector vs BoolVector）
    - [v] 所有可用的原語（函數和終端）
    - [v] 類型約束如何工作
    - [v] Ephemeral 常數的作用
  - **關鍵問題**:
    - 為什麼需要類型系統？
    - 如何保證生成的規則合法？
    - 可以添加新的原語嗎？
  - **預估時間**: 30 分鐘
  - **筆記**: 已理解類型約束不會被破壞 ✅

### 3. 自定義原語實現
- [v] **gp_quant/gp/primitives.py** (~200 行)
  - **優先級**: 🔴 高
  - **為什麼重要**: 實現所有技術指標和運算
  - **需要理解**:
    - [v] 技術指標實現（RSI, SMA, ROC, etc.）
    - [v] Protected 運算（除法、對數）
    - [v] 向量化運算的處理
    - [v] 邊界條件處理
  - **關鍵問題**:
    - 技術指標計算是否正確？
    - 如何處理 NaN 和 Inf？
    - 性能優化的考量？
  - **預估時間**: 45 分鐘

### 4. 數據加載器
- [v] **gp_quant/data/loader.py** (143 行)
  - **優先級**: 🔴 高
  - **為什麼重要**: 數據預處理和分割邏輯
  - **需要理解**:
    - [v] `load_and_process_data()` 數據清洗
    - [v] `split_train_test_data()` 新結構（已重構）
    - [v] 初始期和回測期的分離
    - [v] 數據不足時的處理
  - **關鍵問題**:
    - 如何處理缺失數據？
    - 日期對齊如何確保？
    - 新舊數據結構的兼容性？
  - **預估時間**: 30 分鐘

---

## 🟡 P1 - 重要 (1/1 完成)

### 5. 回測引擎
- [v] **gp_quant/backtesting/engine.py** (~455 行)
  - **優先級**: 🟡 高
  - **為什麼重要**: 評估交易策略的核心
  - **需要理解**:
    - [v] `BacktestingEngine` 類
      - [v] `__init__()` - 初始期支持
      - [v] `evaluate()` - Fitness 計算
      - [v] `_run_vectorized_simulation()` - 向量化回測
      - [v] `run_detailed_simulation()` - 詳細交易記錄
      - [v] `get_signals()` - 信號生成
    - [v] `PortfolioBacktestingEngine` 類
      - [v] 多 ticker 管理
      - [v] backtest_config 傳遞
    - [v] Numba JIT 優化
  - **關鍵問題**:
    - 如何計算 excess return？
    - 向量化如何提升性能？
    - 初始期數據如何使用？
  - **預估時間**: 60 分鐘

---

## 🟢 P2 - 補充 (0/3 完成)

### 6. 實驗腳本
- [ ] **run_all_experiments.py** (~364 行)
  - **優先級**: 🟡 中
  - **為什麼重要**: 大規模實驗自動化
  - **需要理解**:
    - [ ] `modify_main_py()` - 動態修改配置
    - [ ] `run_single_experiment()` - 單次實驗流程
    - [ ] `run_all_experiments()` - 80 次實驗編排
    - [ ] 結果提取和保存
  - **關鍵問題**:
    - 如何確保實驗可重現？
    - 如何處理實驗失敗？
    - 結果如何匯總分析？
  - **預估時間**: 40 分鐘

---

## 🟢 P2 - 補充 (0/2 完成)

### 7. 其他實驗腳本
- [ ] **run_both_experiments.py** (~300 行)
  - **優先級**: 🟢 低
  - **需要理解**: 短/長訓練期對比實驗
  - **預估時間**: 25 分鐘

- [ ] **run_experiments.py** (~100 行)
  - **優先級**: 🟢 低
  - **需要理解**: 基礎實驗腳本
  - **預估時間**: 15 分鐘

### 8. 可視化腳本
- [ ] **plot_pnl.py** (~100 行)
  - **優先級**: 🟢 低
  - **需要理解**: 如何繪製 PnL 曲線
  - **預估時間**: 20 分鐘

---

## 🔵 P3 - 參考文檔 (0/4 完成)

### 9. 專案需求文檔
- [ ] **PRD.md** (8517 bytes)
  - **優先級**: 🔵 參考
  - **需要理解**: 
    - [ ] Section 7: 實驗設計（時間配置）
    - [ ] 技術指標定義
    - [ ] 評估指標
  - **預估時間**: 30 分鐘

### 10. 設計文檔
- [ ] **BACKTEST_REFACTOR_DESIGN.md** (14057 bytes)
  - **優先級**: 🔵 參考
  - **需要理解**: 回測引擎重構的設計思路
  - **預估時間**: 20 分鐘

- [ ] **REFACTOR_SUMMARY.md** (已創建)
  - **優先級**: 🔵 參考
  - **需要理解**: 重構完成總結
  - **預估時間**: 15 分鐘

### 11. 實驗結果文檔
- [ ] **EXPERIMENTS_README.md** (4938 bytes)
  - **優先級**: 🔵 參考
  - **需要理解**: 實驗結果結構說明
  - **預估時間**: 10 分鐘

### 12. DEAP 指南
- [ ] **DEAP_implementation_guide.md** (7489 bytes)
  - **優先級**: 🔵 參考
  - **需要理解**: DEAP 框架使用指南
  - **預估時間**: 25 分鐘

### 13. Onboarding 文檔
- [ ] **ONBOARDING.md** (6724 bytes)
  - **優先級**: 🔵 參考
  - **需要理解**: 專案入門指南
  - **預估時間**: 20 分鐘

---

## 📝 Review 筆記區

### main.py 筆記 (2025-10-01)
- ✅ 理解三種執行模式
- ✅ 理解時間配置（初始期 + 回測期）
- ✅ 理解 pop, log, hof 三個返回值
- ✅ 理解 backtest_config 的傳遞
- ⚠️ 註釋需要修正（Line 68: 應該是短訓練期而非長訓練期）
- 💡 建議: 考慮將時間配置參數化

### evolution/engine.py 部分筆記 (2025-10-01)
- ✅ 理解 DEAP Toolbox 配置
- ✅ 理解類型系統不會被變異破壞
- ✅ 理解統計記錄機制
- 🔄 需要完整 review 演化循環

---

## 🎯 建議 Review 順序

### 第一階段：核心理解 (預計 3 小時)
1. ✅ main.py (已完成)
2. gp_quant/evolution/engine.py (45 分鐘)
3. gp_quant/gp/operators.py (30 分鐘)
4. gp_quant/gp/primitives.py (45 分鐘)
5. gp_quant/data/loader.py (30 分鐘)

### 第二階段：深入回測 (預計 1 小時)
6. ✅ gp_quant/backtesting/engine.py (已完成)
7. ✅ ranked_selection (已在 engine.py 中完成)

### 第三階段：實驗流程 (預計 1 小時)
6. run_all_experiments.py (40 分鐘)
7. run_both_experiments.py (25 分鐘)

### 第四階段：補充和文檔 (預計 1.5 小時)
8. 可視化和其他腳本 (30 分鐘)
9. 文檔閱讀 (1 小時)

**總預估時間**: 6.5 小時

---

## 📊 關鍵概念檢查清單

完成 review 後，確保你能回答以下問題：

### GP 演化
- [ ] GP 樹的結構是什麼？
- [ ] 如何生成初始族群？
- [ ] 選擇、交配、變異如何工作？
- [ ] 類型系統如何保證規則合法？
- [ ] Hall of Fame 如何更新？

### 回測系統
- [ ] 如何計算 fitness (excess return)？
- [ ] 初始期和回測期如何分離？
- [ ] 向量化回測如何實現？
- [ ] 如何處理數據不足的情況？
- [ ] Portfolio 模式如何管理多個 ticker？

### 技術指標
- [ ] RSI 如何計算？
- [ ] 移動平均如何實現？
- [ ] 如何處理 NaN 和 Inf？
- [ ] 技術指標的向量化實現？

### 實驗設計
- [ ] 短訓練期和長訓練期的配置？
- [ ] 如何確保實驗可重現？
- [ ] 如何分析實驗結果？
- [ ] 80 次實驗的意義？

---

## 🔧 實踐任務

理論理解後，建議完成以下實踐：

- [ ] 運行一次完整實驗（2 代，10 個體）
- [ ] 修改一個技術指標參數並觀察影響
- [ ] 添加一個新的技術指標
- [ ] 繪製演化曲線圖
- [ ] 分析一個最佳交易規則
- [ ] 對比短訓練期和長訓練期的結果

---

## 📚 參考資源

- **DEAP 官方文檔**: https://deap.readthedocs.io/
- **GP 入門**: Koza, J. R. (1992). Genetic Programming
- **技術指標**: Technical Analysis of the Financial Markets

---

**更新日誌**:
- 2025-10-01: 創建 checklist，完成 main.py review
- 2025-10-01: 部分理解 evolution/engine.py 的 DEAP 配置

**下一步**: Review `gp_quant/evolution/engine.py` 的完整演化循環
